@ECHO OFF

REM Check whether all options were passed
IF "%1" == "" GOTO MISSOPT
IF "%2" == "" GOTO MISSOPT

REM Check whether all the files exist on the disk
ECHO Checking that all patch files are on the disk.
IF NOT EXIST ATTRIB.EXE GOTO MISSDISK
IF NOT EXIST BLDLEVEL.COM GOTO MISSDISK
IF NOT EXIST COMMAND.COM GOTO MISSDISK
IF NOT EXIST DEBUG.COM GOTO MISSDISK
IF NOT EXIST DYNALOAD.COM GOTO MISSDISK
IF NOT EXIST FDISK32.COM GOTO MISSDISK
IF NOT EXIST FORMAT.COM GOTO MISSDISK
IF NOT EXIST FORMAT32.COM GOTO MISSDISK
IF NOT EXIST HIMEM.SYS GOTO MISSDISK
IF NOT EXIST IBMBIO.COM GOTO MISSDISK
IF NOT EXIST IBMCDET.SYS GOTO MISSDISK
IF NOT EXIST IBMDOS.COM GOTO MISSDISK
IF NOT EXIST IBMIDECD.SYS GOTO MISSDISK
IF NOT EXIST IPSRASPI.SYS GOTO MISSDISK
IF NOT EXIST MSCDEX.EXE GOTO MISSDISK
IF NOT EXIST NOINT25.COM GOTO MISSDISK
ECHO Found all the patch files.

REM Check whether the installed files exist
ECHO Checking whether expected PC DOS 7.01 files exist.
IF NOT EXIST %1\%2\COMMAND.COM GOTO MISSDOS
IF NOT EXIST %1\COMMAND.COM GOTO MISSDOS
IF NOT EXIST %1\%2\DEBUG.COM GOTO MISSDOS
IF NOT EXIST %1\%2\DYNALOAD.COM GOTO MISSDOS
IF NOT EXIST %1\%2\FORMAT.COM GOTO MISSDOS
IF NOT EXIST %1\%2\HIMEM.SYS GOTO MISSDOS
IF NOT EXIST %1\IBMBIO.COM GOTO MISSDOS
IF NOT EXIST %1\IBMDOS.COM GOTO MISSDOS
IF NOT EXIST %1\%2\MSCDEX.EXE GOTO MISSDOS
ECHO Found all expected PC DOS 7.01 files.

GOTO DOPATCH

:MISSOPT
ECHO PC-DOS 7.01 to 7.1 patcher
ECHO.
ECHO Usage:
ECHO %0 [DRIVE] [DOSDIR]
ECHO.
ECHO Example:
ECHO %0 C: DOS
GOTO END

:MISSDISK
ECHO Could not find one or more files on this disk.
ECHO Please ensure the following files are present on this disk and try again:
ECHO ATTRIB.EXE
ECHO BLDLEVEL.COM
ECHO COMMAND.COM
ECHO DEBUG.COM
ECHO DYNALOAD.COM
ECHO FDISK32.COM
ECHO FORMAT.COM
ECHO FORMAT32.COM
ECHO HIMEM.SYS
ECHO IBMBIO.COM
ECHO IBMCDET.SYS
ECHO IBMDOS.COM
ECHO IBMIDECD.SYS
ECHO IPSRASPI.SYS
ECHO MSCDEX.EXE
ECHO NOINT25.COM
GOTO END

:MISSDOS
ECHO Could not locate one or more files in existing DOS installation.
ECHO Please ensure that the following files are in the specified locations:
ECHO %1\%2\COMMAND.COM
ECHO %1\COMMAND.COM
ECHO %1\%2\DEBUG.COM
ECHO %1\%2\DYNALOAD.COM
ECHO %1\%2\FORMAT.COM
ECHO %1\%2\HIMEM.SYS
ECHO %1\IBMBIO.COM
ECHO %1\IBMDOS.COM
ECHO %1\%2\MSCDEX.EXE
GOTO END

:DOPATCH
ECHO Beginning patching.

ECHO Copying BLDLEVEL.COM
IF EXIST %1\%2\BLDLEVEL.COM DEL %1\%2\BLDLEVEL.COM
COPY BLDLEVEL.COM %1\%2 > NUL

ECHO Copying COMMAND.COM
DEL %1\%2\COMMAND.COM
COPY COMMAND.COM %1\%2 > NUL
DEL %1\COMMAND.COM
COPY COMMAND.COM %1 > NUL

ECHO Copying DEBUG.COM
DEL %1\%2\DEBUG.COM
COPY DEBUG.COM %1\%2 > NUL

ECHO Copying DYNALOAD.COM
DEL %1\%2\DYNALOAD.COM
COPY DYNALOAD.COM %1\%2 > NUL

ECHO Copying FDISK32.COM
IF EXIST %1\%2\FDISK32.COM DEL %1\%2\FDISK32.COM
COPY FDISK32.COM %1\%2 > NUL

ECHO Copying FORMAT.COM
DEL %1\%2\FORMAT.COM
COPY FORMAT.COM %1\%2 > NUL

ECHO Copying FORMAT32.COM
IF EXIST %1\%2\FORMAT32.COM DEL %1\%2\FORMAT32.COM
COPY FORMAT32.COM %1\%2 > NUL

ECHO Copying HIMEM.SYS
DEL %1\%2\HIMEM.SYS
COPY HIMEM.SYS %1\%2 > NUL

ECHO Copying IBMBIO.COM
ATTRIB -S -H -R %1\IBMBIO.COM
DEL %1\IBMBIO.COM
COPY IBMBIO.COM %1 > NUL
ATTRIB +S +H +R %1\IBMBIO.COM

ECHO Copying IBMCDET.SYS
IF EXIST %1\%2\IBMCDET.SYS DEL %1\%2\IBMCDET.SYS
COPY IBMCDET.SYS %1\%2 > NUL

ECHO Copying IBMDOS.COM
ATTRIB -S -H -R %1\IBMDOS.COM
DEL %1\IBMDOS.COM
COPY IBMDOS.COM %1 > NUL
ATTRIB +S +H +R %1\IBMDOS.COM

ECHO Copying IBMIDECD.SYS
IF EXIST %1\%2\IBMIDECD.SYS DEL %1\%2\IBMIDECD.SYS
COPY IBMIDECD.SYS %1\%2 > NUL

ECHO Copying ISPRASPI.SYS
IF EXIST %1\%2\IPSRASPI.SYS DEL %1\%2\IPSRASPI.SYS
COPY IPSRASPI.SYS %1\%2 > NUL

ECHO Copying MSCDEX.EXE
DEL %1\%2\MSCDEX.EXE
COPY MSCDEX.EXE %1\%2 > NUL

ECHO Copying NOINT25.COM
IF EXIST %1\%2\NOINT25.COM DEL %1\%2\NOINT25.COM
COPY NOINT25.COM %1\%2 > NUL

ECHO Patching complete.
ECHO Remove the patch disk and reboot.

:END