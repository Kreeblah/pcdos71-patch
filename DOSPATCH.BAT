@ECHO OFF

REM Check whether all options were passed
IF "%1" == "" GOTO MISSOPT
IF "%2" == "" GOTO MISSOPT

REM Check whether all the files exist on the disk
ECHO Checking that all patch files are on the disk.
IF NOT EXIST ATTRIB.EXE GOTO MISSDISK
IF NOT EXIST BLDLEVEL.COM GOTO MISSDISK
IF NOT EXIST COMMAND.COM GOTO MISSDISK
IF NOT EXIST DEBUG.COM GOTO MISSDISK
IF NOT EXIST DYNALOAD.COM GOTO MISSDISK
IF NOT EXIST FDISK32.COM GOTO MISSDISK
IF NOT EXIST FORMAT.COM GOTO MISSDISK
IF NOT EXIST FORMAT32.COM GOTO MISSDISK
IF NOT EXIST HIMEM.SYS GOTO MISSDISK
IF NOT EXIST IBMBIO.COM GOTO MISSDISK
IF NOT EXIST IBMCDET.SYS GOTO MISSDISK
IF NOT EXIST IBMDOS.COM GOTO MISSDISK
IF NOT EXIST IBMIDECD.SYS GOTO MISSDISK
IF NOT EXIST IPSRASPI.SYS GOTO MISSDISK
IF NOT EXIST MD5SUM.EXE GOTO MISSDISK
IF NOT EXIST MSCDEX.EXE GOTO MISSDISK
IF NOT EXIST NOINT25.COM GOTO MISSDISK
ECHO Found all the patch files.

REM Check the integrity of files on the disk
ECHO Checking the integrity of the files on the disk.
MD5SUM -b -d f5e7252357a971703fe0990838f94141 ATTRIB.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 7212c02df1f6f98b0dac6d4941a4b8ea BLDLEVEL.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 9c3a8a319d72c3f7b1dd1f821637262a COMMAND.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d ef8d16e424e8fc91c3a5bc416a0b1adb DEBUG.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 4bd3102dd2abe4b8a1124e8387b0988e DYNALOAD.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d b2d1df9bc43728d5e61a721ccd3888ed FDISK32.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d a73fac6317480fa74a80e4675c963797 FORMAT.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 9e802b31cef262fa0ca9d3603d9a358f FORMAT32.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d d08e20e46cb862331130c8e6d829f8b3 HIMEM.SYS > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d d31b3f077e548791544df2070469836e IBMBIO.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d d764d793a8f93e0cb98496cc16622df8 IBMCDET.SYS > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 7f03764471d91e450f960eae084831a6 IBMDOS.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 39978702c2048697217024497576a8cf IBMIDECD.SYS > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 9a1fb111c6e1ecccb03a4688176a8737 IPSRASPI.SYS > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 00ee870f9fb9ac113c1b83c8762b11ef MD5SUM.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 38e6c8e713ac9c35c6b0a993b8ec8a9f MSCDEX.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDISK
MD5SUM -b -d 9812a816229aa71b6f36488649afd525 NOINT25.COM > NUL
IF ERRORLEVEL 1 GOTO BADDISK
ECHO All files on the disk have expected MD5 digests.

REM Check whether the installed files exist
ECHO Checking whether expected PC DOS 7.01 files exist.
IF NOT EXIST %1\%2\COMMAND.COM GOTO MISSDOS
IF NOT EXIST %1\COMMAND.COM GOTO MISSDOS
IF NOT EXIST %1\%2\DEBUG.COM GOTO MISSDOS
IF NOT EXIST %1\%2\DYNALOAD.COM GOTO MISSDOS
IF NOT EXIST %1\%2\FORMAT.COM GOTO MISSDOS
IF NOT EXIST %1\%2\HIMEM.SYS GOTO MISSDOS
IF NOT EXIST %1\IBMBIO.COM GOTO MISSDOS
IF NOT EXIST %1\IBMDOS.COM GOTO MISSDOS
IF NOT EXIST %1\%2\MSCDEX.EXE GOTO MISSDOS
ECHO Found all expected PC DOS 7.01 files.

REM Check whether the expected files are at the patch location
ECHO Checking whether files to be patched are the correct files.
MD5SUM -b -d 990d962397a6815cfc9cf198cefc5082 %1\%2\COMMAND.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d 990d962397a6815cfc9cf198cefc5082 %1\COMMAND.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d 034a5b2c5fd507d5da897f7423701f97 %1\%2\DEBUG.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d bd26c41e6256eb454dd6863109d7a703 %1\%2\DYNALOAD.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d ad70511bae8d2d66b0ddbd6db303a5f0 %1\%2\FORMAT.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d 289c1c8c2becd17e5503f59aaa4b4afd %1\%2\HIMEM.SYS > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d 3044e518ebcb59224e8af044c2faa218 %1\IBMBIO.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d fa94fdb95a587f0b433d35165a4df05e %1\IBMDOS.COM > NUL
IF ERRORLEVEL 1 GOTO BADDOS
MD5SUM -b -d 2e0b2032a237c70b6d89ee50d45206ef %1\%2\MSCDEX.EXE > NUL
IF ERRORLEVEL 1 GOTO BADDOS
ECHO All files at the patch location have expected MD5 digests.

GOTO DOPATCH

:MISSOPT
ECHO PC-DOS 7.01 to 7.1 patcher
ECHO.
ECHO Usage:
ECHO %0 [DRIVE] [DOSDIR]
ECHO.
ECHO Example:
ECHO %0 C: DOS
GOTO END

:MISSDISK
ECHO Could not find one or more files on this disk.
ECHO Please ensure the following files are present on this disk and try again:
ECHO ATTRIB.EXE
ECHO BLDLEVEL.COM
ECHO COMMAND.COM
ECHO DEBUG.COM
ECHO DYNALOAD.COM
ECHO FDISK32.COM
ECHO FORMAT.COM
ECHO FORMAT32.COM
ECHO HIMEM.SYS
ECHO IBMBIO.COM
ECHO IBMCDET.SYS
ECHO IBMDOS.COM
ECHO IBMIDECD.SYS
ECHO IPSRASPI.SYS
ECHO MD5SUM.EXE
ECHO MSCDEX.EXE
ECHO NOINT25.COM
GOTO END

:MISSDOS
ECHO Could not locate one or more files in existing DOS installation.
ECHO Please ensure that the following files are in the specified locations:
ECHO %1\%2\COMMAND.COM
ECHO %1\COMMAND.COM
ECHO %1\%2\DEBUG.COM
ECHO %1\%2\DYNALOAD.COM
ECHO %1\%2\FORMAT.COM
ECHO %1\%2\HIMEM.SYS
ECHO %1\IBMBIO.COM
ECHO %1\IBMDOS.COM
ECHO %1\%2\MSCDEX.EXE
GOTO END

:BADDISK
ECHO One or more files on the disk does not have an expected MD5 digest.
ECHO Please check the files on the disk against the following digests
ECHO and place the correct files on this disk.
ECHO.
ECHO f5e7252357a971703fe0990838f94141 *ATTRIB.EXE
ECHO 7212c02df1f6f98b0dac6d4941a4b8ea *BLDLEVEL.COM
ECHO 9c3a8a319d72c3f7b1dd1f821637262a *COMMAND.COM
ECHO ef8d16e424e8fc91c3a5bc416a0b1adb *DEBUG.COM
ECHO 4bd3102dd2abe4b8a1124e8387b0988e *DYNALOAD.COM
ECHO b2d1df9bc43728d5e61a721ccd3888ed *FDISK32.COM
ECHO a73fac6317480fa74a80e4675c963797 *FORMAT.COM
ECHO 9e802b31cef262fa0ca9d3603d9a358f *FORMAT32.COM
ECHO d08e20e46cb862331130c8e6d829f8b3 *HIMEM.SYS
ECHO d31b3f077e548791544df2070469836e *IBMBIO.COM
ECHO d764d793a8f93e0cb98496cc16622df8 *IBMCDET.SYS
ECHO 7f03764471d91e450f960eae084831a6 *IBMDOS.COM
ECHO 39978702c2048697217024497576a8cf *IBMIDECD.SYS
ECHO 9a1fb111c6e1ecccb03a4688176a8737 *IPSRASPI.SYS
ECHO 00ee870f9fb9ac113c1b83c8762b11ef *MD5SUM.EXE
ECHO 38e6c8e713ac9c35c6b0a993b8ec8a9f *MSCDEX.EXE
ECHO 9812a816229aa71b6f36488649afd525 *NOINT25.COM
GOTO END

:BADDOS
ECHO One or more files at the patch location does not have an
ECHO expected MD5 digest.  Please check the files in the patch
ECHO location against the following digests.
ECHO.
ECHO 990d962397a6815cfc9cf198cefc5082 *%1\%2\COMMAND.COM
ECHO 990d962397a6815cfc9cf198cefc5082 *%1\COMMAND.COM
ECHO 034a5b2c5fd507d5da897f7423701f97 *%1\%2\DEBUG.COM
ECHO bd26c41e6256eb454dd6863109d7a703 *%1\%2\DYNALOAD.COM
ECHO ad70511bae8d2d66b0ddbd6db303a5f0 *%1\%2\FORMAT.COM
ECHO 289c1c8c2becd17e5503f59aaa4b4afd *%1\%2\HIMEM.SYS
ECHO 3044e518ebcb59224e8af044c2faa218 *%1\IBMBIO.COM
ECHO fa94fdb95a587f0b433d35165a4df05e *%1\IBMDOS.COM
ECHO 2e0b2032a237c70b6d89ee50d45206ef *%1\%2\MSCDEX.EXE
GOTO END

:DOPATCH
ECHO Beginning patching.

ECHO Copying BLDLEVEL.COM
IF EXIST %1\%2\BLDLEVEL.COM DEL %1\%2\BLDLEVEL.COM
COPY BLDLEVEL.COM %1\%2 > NUL

ECHO Copying COMMAND.COM
DEL %1\%2\COMMAND.COM
COPY COMMAND.COM %1\%2 > NUL
DEL %1\COMMAND.COM
COPY COMMAND.COM %1 > NUL

ECHO Copying DEBUG.COM
DEL %1\%2\DEBUG.COM
COPY DEBUG.COM %1\%2 > NUL

ECHO Copying DYNALOAD.COM
DEL %1\%2\DYNALOAD.COM
COPY DYNALOAD.COM %1\%2 > NUL

ECHO Copying FDISK32.COM
IF EXIST %1\%2\FDISK32.COM DEL %1\%2\FDISK32.COM
COPY FDISK32.COM %1\%2 > NUL

ECHO Copying FORMAT.COM
DEL %1\%2\FORMAT.COM
COPY FORMAT.COM %1\%2 > NUL

ECHO Copying FORMAT32.COM
IF EXIST %1\%2\FORMAT32.COM DEL %1\%2\FORMAT32.COM
COPY FORMAT32.COM %1\%2 > NUL

ECHO Copying HIMEM.SYS
DEL %1\%2\HIMEM.SYS
COPY HIMEM.SYS %1\%2 > NUL

ECHO Copying IBMBIO.COM
ATTRIB -S -H -R %1\IBMBIO.COM
DEL %1\IBMBIO.COM
COPY IBMBIO.COM %1 > NUL
ATTRIB +S +H +R %1\IBMBIO.COM

ECHO Copying IBMCDET.SYS
IF EXIST %1\%2\IBMCDET.SYS DEL %1\%2\IBMCDET.SYS
COPY IBMCDET.SYS %1\%2 > NUL

ECHO Copying IBMDOS.COM
ATTRIB -S -H -R %1\IBMDOS.COM
DEL %1\IBMDOS.COM
COPY IBMDOS.COM %1 > NUL
ATTRIB +S +H +R %1\IBMDOS.COM

ECHO Copying IBMIDECD.SYS
IF EXIST %1\%2\IBMIDECD.SYS DEL %1\%2\IBMIDECD.SYS
COPY IBMIDECD.SYS %1\%2 > NUL

ECHO Copying ISPRASPI.SYS
IF EXIST %1\%2\IPSRASPI.SYS DEL %1\%2\IPSRASPI.SYS
COPY IPSRASPI.SYS %1\%2 > NUL

ECHO Copying MSCDEX.EXE
DEL %1\%2\MSCDEX.EXE
COPY MSCDEX.EXE %1\%2 > NUL

ECHO Copying NOINT25.COM
IF EXIST %1\%2\NOINT25.COM DEL %1\%2\NOINT25.COM
COPY NOINT25.COM %1\%2 > NUL

ECHO Patching complete.
ECHO Remove the patch disk and reboot.

:END