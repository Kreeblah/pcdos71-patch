@ECHO OFF

REM Check whether all options were passed
IF "%1" == "" GOTO MISSOPT
IF "%2" == "" GOTO MISSOPT

REM Check whether all the files exist on the disk
ECHO Checking that all patch files are on the disk.
IF NOT EXIST ATTRIB.EXE GOTO MISSDISK
IF NOT EXIST BLDLEVEL.COM GOTO MISSDISK
IF NOT EXIST CHKDSK.COM GOTO MISSDISK
IF NOT EXIST COMMAND.COM GOTO MISSDISK
IF NOT EXIST COUNTRY.SYS GOTO MISSDISK
IF NOT EXIST DEBUG.COM GOTO MISSDISK
IF NOT EXIST DELTREE.EXE GOTO MISSDISK
IF NOT EXIST DISPLAY.SYS GOTO MISSDISK
IF NOT EXIST DOSKEY.COM GOTO MISSDISK
IF NOT EXIST DYNALOAD.COM GOTO MISSDISK
IF NOT EXIST E.EX GOTO MISSDISK
IF NOT EXIST E.EXE GOTO MISSDISK
IF NOT EXIST E.INI GOTO MISSDISK
IF NOT EXIST FC.EXE GOTO MISSDISK
IF NOT EXIST FDISK32.COM GOTO MISSDISK
IF NOT EXIST FIND.EXE GOTO MISSDISK
IF NOT EXIST FORMAT.COM GOTO MISSDISK
IF NOT EXIST FORMAT32.COM GOTO MISSDISK
IF NOT EXIST HIMEM.SYS GOTO MISSDISK
IF NOT EXIST IBMBIO.COM GOTO MISSDISK
IF NOT EXIST IBMCDET.SYS GOTO MISSDISK
IF NOT EXIST IBMDOS.COM GOTO MISSDISK
IF NOT EXIST IBMIDECD.SYS GOTO MISSDISK
IF NOT EXIST IPSRASPI.SYS GOTO MISSDISK
IF NOT EXIST KEYB.COM GOTO MISSDISK
IF NOT EXIST KEYBOARD.SYS GOTO MISSDISK
IF NOT EXIST LABEL.COM GOTO MISSDISK
IF NOT EXIST MEM.EXE GOTO MISSDISK
IF NOT EXIST MODE.COM GOTO MISSDISK
IF NOT EXIST MORE.COM GOTO MISSDISK
IF NOT EXIST MOUSE.COM GOTO MISSDISK
IF NOT EXIST MOVE.EXE GOTO MISSDISK
IF NOT EXIST MSCDEX.EXE GOTO MISSDISK
IF NOT EXIST NOINT25.COM GOTO MISSDISK
IF NOT EXIST RAMDRIVE.SYS GOTO MISSDISK
IF NOT EXIST SMARTDRV.EXE GOTO MISSDISK
IF NOT EXIST SUBST.EXE GOTO MISSDISK
IF NOT EXIST SYS.COM GOTO MISSDISK
IF NOT EXIST TREE.COM GOTO MISSDISK
IF NOT EXIST XCOPY.EXE GOTO MISSDISK
ECHO Found all the patch files.

REM Check whether the installed files exist
ECHO Checking whether expected PC DOS 7.01 files exist.
IF NOT EXIST %1\%2\ATTRIB.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\CHKDSK.COM GOTO MISSDOS
IF NOT EXIST %1\%2\COMMAND.COM GOTO MISSDOS
IF NOT EXIST %1\COMMAND.COM GOTO MISSDOS
IF NOT EXIST %1\%2\COUNTRY.SYS GOTO MISSDOS
IF NOT EXIST %1\%2\DEBUG.COM GOTO MISSDOS
IF NOT EXIST %1\%2\DELTREE.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\DISPLAY.SYS GOTO MISSDOS
IF NOT EXIST %1\%2\DOSKEY.COM GOTO MISSDOS
IF NOT EXIST %1\%2\DYNALOAD.COM GOTO MISSDOS
IF NOT EXIST %1\%2\E.EX GOTO MISSDOS
IF NOT EXIST %1\%2\E.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\E.INI GOTO MISSDOS
IF NOT EXIST %1\%2\FC.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\FIND.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\FORMAT.COM GOTO MISSDOS
IF NOT EXIST %1\%2\HIMEM.SYS GOTO MISSDOS
IF NOT EXIST %1\IBMBIO.COM GOTO MISSDOS
IF NOT EXIST %1\IBMDOS.COM GOTO MISSDOS
IF NOT EXIST %1\%2\KEYB.COM GOTO MISSDOS
IF NOT EXIST %1\%2\KEYBOARD.SYS GOTO MISSDOS
IF NOT EXIST %1\%2\LABEL.COM GOTO MISSDOS
IF NOT EXIST %1\%2\MEM.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\MODE.COM GOTO MISSDOS
IF NOT EXIST %1\%2\MORE.COM GOTO MISSDOS
IF NOT EXIST %1\%2\MOUSE.COM GOTO MISSDOS
IF NOT EXIST %1\%2\MOVE.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\MSCDEX.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\RAMDRIVE.SYS GOTO MISSDOS
IF NOT EXIST %1\%2\SMARTDRV.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\SUBST.EXE GOTO MISSDOS
IF NOT EXIST %1\%2\SYS.COM GOTO MISSDOS
IF NOT EXIST %1\%2\TREE.COM GOTO MISSDOS
IF NOT EXIST %1\%2\XCOPY.EXE GOTO MISSDOS
ECHO Found all expected PC DOS 7.01 files.

GOTO DOPATCH

:MISSOPT
ECHO PC-DOS 7.01 to 7.1 patcher
ECHO.
ECHO Usage:
ECHO %0 [DRIVE] [DOSDIR]
ECHO.
ECHO Example:
ECHO %0 C: DOS
GOTO END

:MISSDISK
ECHO Could not find one or more files on this disk.
ECHO Please ensure the following files are present on this disk and try again:
ECHO ATTRIB.EXE
ECHO BLDLEVEL.COM
ECHO CHKDSK.COM
ECHO COMMAND.COM
ECHO COUNTRY.SYS
ECHO DEBUG.COM
ECHO DELTREE.EXE
ECHO DISPLAY.SYS
ECHO DOSKEY.COM
ECHO DYNALOAD.COM
ECHO E.EX
ECHO E.EXE
ECHO E.INI
ECHO FC.EXE
ECHO FDISK32.COM
ECHO FIND.EXE
ECHO FORMAT.COM
ECHO FORMAT32.COM
ECHO HIMEM.SYS
ECHO IBMBIO.COM
ECHO IBMCDET.SYS
ECHO IBMDOS.COM
ECHO IBMIDECD.SYS
ECHO IPSRASPI.SYS
ECHO KEYB.COM
ECHO KEYBOARD.SYS
ECHO LABEL.COM
ECHO MEM.EXE
ECHO MODE.COM
ECHO MORE.COM
ECHO MOUSE.COM
ECHO MOVE.EXE
ECHO MSCDEX.EXE
ECHO NOINT25.COM
ECHO RAMDRIVE.SYS
ECHO SMARTDRV.EXE
ECHO SUBST.EXE
ECHO SYS.COM
ECHO TREE.COM
ECHO XCOPY.EXE
GOTO END

:MISSDOS
ECHO Could not locate one or more files in existing DOS installation.
ECHO Please ensure that the following files are in the specified locations:
ECHO %1\%2\ATTRIB.EXE
ECHO %1\%2\CHKDSK.COM
ECHO %1\%2\COMMAND.COM
ECHO %1\COMMAND.COM
ECHO %1\%2\COUNTRY.SYS
ECHO %1\%2\DEBUG.COM
ECHO %1\%2\DELTREE.EXE
ECHO %1\%2\DISPLAY.SYS
ECHO %1\%2\DOSKEY.COM
ECHO %1\%2\DYNALOAD.COM
ECHO %1\%2\E.EX
ECHO %1\%2\E.EXE
ECHO %1\%2\E.INI
ECHO %1\%2\FC.EXE
ECHO %1\%2\FIND.EXE
ECHO %1\%2\FORMAT.COM
ECHO %1\%2\HIMEM.SYS
ECHO %1\IBMBIO.COM
ECHO %1\IBMDOS.COM
ECHO %1\%2\KEYB.COM
ECHO %1\%2\KEYBOARD.SYS
ECHO %1\%2\LABEL.COM
ECHO %1\%2\MEM.EXE
ECHO %1\%2\MODE.COM
ECHO %1\%2\MORE.COM
ECHO %1\%2\MOUSE.COM
ECHO %1\%2\MOVE.EXE
ECHO %1\%2\MSCDEX.EXE
ECHO %1\%2\RAMDRIVE.SYS
ECHO %1\%2\SMARTDRV.EXE
ECHO %1\%2\SUBST.EXE
ECHO %1\%2\SYS.COM
ECHO %1\%2\TREE.COM
ECHO %1\%2\XCOPY.EXE
GOTO END

:DOPATCH
ECHO Beginning patching.

ECHO Copying ATTRIB.EXE
DEL %1\%2\ATTRIB.EXE
COPY ATTRIB.EXE %1\%2 > NUL

ECHO Copying BLDLEVEL.COM
IF EXIST %1\%2\BLDLEVEL.COM DEL %1\%2\BLDLEVEL.COM
COPY BLDLEVEL.COM %1\%2 > NUL

ECHO Copying CHKDSK.COM
DEL %1\%2\CHKDSK.COM
COPY CHKDSK.COM %1\%2 > NUL

ECHO Copying COMMAND.COM
DEL %1\%2\COMMAND.COM
COPY COMMAND.COM %1\%2 > NUL
DEL %1\COMMAND.COM
COPY COMMAND.COM %1 > NUL

ECHO Copying COUNTRY.SYS
DEL %1\%2\COUNTRY.SYS
COPY COUNTRY.SYS %1\%2 > NUL

ECHO Copying DEBUG.COM
DEL %1\%2\DEBUG.COM
COPY DEBUG.COM %1\%2 > NUL

ECHO Copying DELTREE.EXE
DEL %1\%2\DELTREE.EXE
COPY DELTREE.EXE %1\%2 > NUL

ECHO Copying DISPLAY.SYS
DEL %1\%2\DISPLAY.SYS
COPY DISPLAY.SYS %1\%2 > NUL

ECHO Copying DOSKEY.COM
DEL %1\%2\DOSKEY.COM
COPY DOSKEY.COM %1\%2 > NUL

ECHO Copying DYNALOAD.COM
DEL %1\%2\DYNALOAD.COM
COPY DYNALOAD.COM %1\%2 > NUL

ECHO Copying E.EX
DEL %1\%2\E.EX
COPY E.EX %1\%2 > NUL

ECHO Copying E.EXE
DEL %1\%2\E.EXE
COPY E.EXE %1\%2 > NUL

ECHO Copying E.INI
DEL %1\%2\E.INI
COPY E.INI %1\%2 > NUL

ECHO Copying FC.EXE
DEL %1\%2\FC.EXE
COPY FC.EXE %1\%2 > NUL

ECHO Copying FDISK32.COM
IF EXIST %1\%2\FDISK32.COM DEL %1\%2\FDISK32.COM
COPY FDISK32.COM %1\%2 > NUL

ECHO Copying FIND.EXE
DEL %1\%2\FIND.EXE
COPY FIND.EXE %1\%2 > NUL

ECHO Copying FORMAT.COM
DEL %1\%2\FORMAT.COM
COPY FORMAT.COM %1\%2 > NUL

ECHO Copying FORMAT32.COM
IF EXIST %1\%2\FORMAT32.COM DEL %1\%2\FORMAT32.COM
COPY FORMAT32.COM %1\%2 > NUL

ECHO Copying HIMEM.SYS
DEL %1\%2\HIMEM.SYS
COPY HIMEM.SYS %1\%2 > NUL

ECHO Copying IBMBIO.COM
ATTRIB -S -H -R %1\IBMBIO.COM
DEL %1\IBMBIO.COM
COPY IBMBIO.COM %1 > NUL
ATTRIB +S +H +R %1\IBMBIO.COM

ECHO Copying IBMCDET.SYS
IF EXIST %1\%2\IBMCDET.SYS DEL %1\%2\IBMCDET.SYS
COPY IBMCDET.SYS %1\%2 > NUL

ECHO Copying IBMDOS.COM
ATTRIB -S -H -R %1\IBMDOS.COM
DEL %1\IBMDOS.COM
COPY IBMDOS.COM %1 > NUL
ATTRIB +S +H +R %1\IBMDOS.COM

ECHO Copying IBMIDECD.SYS
IF EXIST %1\%2\IBMIDECD.SYS DEL %1\%2\IBMIDECD.SYS
COPY IBMIDECD.SYS %1\%2 > NUL

ECHO Copying ISPRASPI.SYS
IF EXIST %1\%2\IPSRASPI.SYS DEL %1\%2\IPSRASPI.SYS
COPY IPSRASPI.SYS %1\%2 > NUL

ECHO Copying KEYB.COM
DEL %1\%2\KEYB.COM
COPY KEYB.COM %1\%2 > NUL

ECHO Copying KEYBOARD.SYS
DEL %1\%2\KEYBOARD.SYS
COPY KEYBOARD.SYS %1\%2 > NUL

ECHO Copying LABEL.COM
DEL %1\%2\LABEL.COM
COPY LABEL.COM %1\%2 > NUL

ECHO Copying MEM.EXE
DEL %1\%2\MEM.EXE
COPY MEM.EXE %1\%2 > NUL

ECHO Copying MODE.COM
DEL %1\%2\MODE.COM
COPY MODE.COM %1\%2 > NUL

ECHO Copying MORE.COM
DEL %1\%2\MORE.COM
COPY MORE.COM %1\%2 > NUL

ECHO Copying MOUSE.COM
DEL %1\%2\MOUSE.COM
COPY MOUSE.COM %1\%2 > NUL

ECHO Copying MOVE.EXE
DEL %1\%2\MOVE.EXE
COPY MOVE.EXE %1\%2 > NUL

ECHO Copying MSCDEX.EXE
DEL %1\%2\MSCDEX.EXE
COPY MSCDEX.EXE %1\%2 > NUL

ECHO Copying NOINT25.COM
IF EXIST %1\%2\NOINT25.COM DEL %1\%2\NOINT25.COM
COPY NOINT25.COM %1\%2 > NUL

ECHO Copying RAMDRIVE.SYS
DEL %1\%2\RAMDRIVE.SYS
COPY RAMDRIVE.SYS %1\%2 > NUL

ECHO Copying SMARTDRV.EXE
DEL %1\%2\SMARTDRV.EXE
COPY SMARTDRV.EXE %1\%2 > NUL

ECHO Copying SUBST.EXE
DEL %1\%2\SUBST.EXE
COPY SUBST.EXE %1\%2 > NUL

ECHO Copying SYS.COM
DEL %1\%2\SYS.COM
COPY SYS.COM %1\%2 > NUL

ECHO Copying TREE.COM
DEL %1\%2\TREE.COM
COPY TREE.COM %1\%2 > NUL

ECHO Copying XCOPY.EXE
DEL %1\%2\XCOPY.EXE
COPY XCOPY.EXE %1\%2 > NUL

ECHO Patching complete.
ECHO Remove the patch disk and reboot.

:END